#!/bin/bash -eu

#
# Base CLI command handler.
# This script is used for setting up the environment and elevating privileges
# for executing CLI commands.
#

# prevent modification of executable path
PATH="/bin:/sbin:/usr/bin:/usr/sbin"

# command to execute
USER_CMD="${BASH_SOURCE[0]}"
REAL_CMD="/usr/bin/cli_$(basename "${USER_CMD}")"
if [[ ! -f "${REAL_CMD}" ]]; then
  echo "Invalid CLI command: ${USER_CMD}" >&2
  exit 2
fi

# elevate privileges
if [[ ${EUID} -ne 0 ]]; then
  exec sudo ${USER_CMD} $@
fi

source "${REAL_CMD}"
